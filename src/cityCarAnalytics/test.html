<!DOCTYPE html>
<html>
  <head>
    <style>
       #map {
        height: 1200px;
        width: 80%;
       }
    </style>
  </head>
  <body>
    <h3>My Google Maps for Snow ZAKU</h3>
	<input type="file" name="select" id="select" />
	<div id="result"></div>
	<div id="map"></div>

	<script>
	//行と列の二次元配列にする
	var mymap;
	var itemArr = [];
	// File APIに対応しているか確認
	if(window.File) {
    	var result = document.getElementById('result');
    	var select = document.getElementById('select');
 		
    	// ファイルが選択されたとき
    	select.addEventListener('change', function(e) {
        	// 選択されたファイルの情報を取得
        	var fileData = e.target.files[0];
 
        	var reader = new FileReader();
        	// ファイル読み取りに失敗したとき
        	reader.onerror = function() {
            	alert('ファイル読み取りに失敗しました')
        	}
        	// ファイル読み取りに成功したとき
        	reader.onload = function() {
            	// 行単位で配列にする
            	var lineArr = reader.result.split("\n");
            	// 行と列の二次元配列にする
            	//var itemArr = [];
            	for (var i = 0; i < lineArr.length; i++) {
                	itemArr[i] = lineArr[i].split(",");
            	}
 				
				// tableで出力
            	var insert = '<table>';
            	for (var i = 0; i < itemArr.length; i++) {
                	insert += '<tr>';
                	for (var j = 0; j < itemArr[i].length; j++) {
                    	insert += '<td>';
                    	insert += itemArr[i][j];
                    	insert += '</td>';
                	}
                	insert += '</tr>';
            }
            insert += '</table>';
            result.innerHTML = insert;

 console.log(itemArr)
		//以下のコードがマップに長方形を配置する
        var rectangle = new google.maps.Rectangle({
          strokeColor: '#FF0000',
		  stroleOpacity: 0.8,
		  strokeWeight: 2,
		  fillColor: '#FF0000',
		  fillOpacity: 0.35,
		  map: mymap,
		  bounds: {
			north: Number(itemArr[1][1]),
			south: Number(itemArr[1][2]),
			east: Number(itemArr[1][3]),
			west: Number(itemArr[1][4])
		  }
        });
			}
        	// ファイル読み取りを実行
        	reader.readAsText(fileData);
    	}, false);

	}
    
		//initMap関数はWebページ読み込み時にマップを初期化して追加する
      function initMap() {
        var uluru = {lat: 37.507491, lng: 139.931477};
		//div要素内にマップを作成するために、Googleマップオブジェクトを追加する
        mymap = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: uluru,
		  mapTypeId: 'terrain'
        });
		console.log(itemArr);
      }
    </script>
	<!--指定したURLからAPIを読み込む-->
	<!--callbackパラメータは、APIが完全に読み込まれた後initMap関数を実行する-->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA9VZ997ZsXfgSs8Nw1LkXPy_dYYWVPPFQ&callback=initMap">
    </script>
  </body>
</html>
